trigger:
- main

variables:
  IMAGE_NAME: voting-app-azure-dev-result
  TAG: $(Build.BuildId)
  DOCKER_HUB_USERNAME: akyldocker25

stages:
- stage: Build
  displayName: Build and Push Docker Image
  jobs:
  - job: Build
    displayName: Build and Push
    pool:
      name: azureagent  # your self-hosted agent

    steps:
    # 1. Checkout repository
    - checkout: self
      displayName: Checkout Repository

    # 2. Docker Hub login
    - task: Docker@2
      displayName: Docker Login
      inputs:
        command: login
        containerRegistry: docker-hub

    # 3. Build & push single-platform Docker image
    - script: |
        echo "Building Docker image..."
        docker build -t $(DOCKER_HUB_USERNAME)/$(IMAGE_NAME):$(TAG) -t $(DOCKER_HUB_USERNAME)/$(IMAGE_NAME):latest -f result/Dockerfile result
        echo "Pushing Docker image..."
        docker push $(DOCKER_HUB_USERNAME)/$(IMAGE_NAME):$(TAG)
        docker push $(DOCKER_HUB_USERNAME)/$(IMAGE_NAME):latest
      displayName: Build and Push Docker Image

